<!DOCTYPE html>
<html
        xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
        layout:decorator="../templates/layout">
<head>
    <title>用户管理</title>
    <script>

        var API_URL = '/users/';
        var $modal,
            $table,
            $alert;
        $(function () {

            $("#start").datetimepicker({format: 'Y-m-d H:i:s'});
            $("#end").datetimepicker({format: 'Y-m-d H:i:s'});

            $modal = $('#modal'),
                $table = $('#bootstrapTable'),
                $alert = $('.alert').hide();

            $('#modal .submit').click(function () {
                var row = {};

                $modal.find('input[name]').each(function () {
                    row[$(this).attr('name')] = $(this).val();
                });

                $.ajax({
                    url: API_URL + ($modal.data('id') || ''),
                    type: $modal.data('id') ? 'put' : 'post',
                    contentType: 'application/json',
                    data: JSON.stringify(row),
                    success: function () {
                        $modal.modal('hide');
                        $table.bootstrapTable('refresh');
                        showAlert(($modal.data('id') ? 'Update' : 'Create') + ' item successful!', 'success');
                    },
                    error: function () {
                        $modal.modal('hide');
                        showAlert(($modal.data('id') ? 'Update' : 'Create') + ' item error!', 'danger');
                    }
                });
            });


            $table.bootstrapTable({
                toolbar: "#toolbar",
                idField: "Id",
                pagination: true,
                showRefresh: true,
                showToggle: true,
                showColumns: true,
                search: true,
                clickToSelect: true,
                sidePagination: 'server',
                method: 'post',
                queryParams: function (param) {
                    param = $.extend($("#queryFrom").mineSerializeObject(), param);
                    return param;
                },
                url: "/users/list",
                columns: [{
                    checkbox: true
                }, {
                    field: "id",
                    title: "ID",
                }, {
                    field: "userName",
                    title: "用户名",
                    editable: {
                        type: 'text',
                        title: '用户名',
                        validate: function (v) {
                            if (!v) return '用户名不能为空';

                        }
                    }
                }, {
                    field: "createdOn",
                    title: "创建时间",
                }, {
                    field: "updatedOn",
                    title: "更新时间",
//                    formatter: function (value, row, index) {
//                        var date = eval('new ' + eval(value).source)
//                        return date.format("yyyy-MM-dd");
//                    }
                }],
                onEditableSave: function (field, row, oldValue, $el) {
                    $.ajax({
                        type: "post",
                        url: "/users",
                        data: row,
                        dataType: 'JSON',
                        success: function (data, status) {
                            if (status == "success") {
                                alert('提交数据成功');
                            }
                        },
                        error: function () {
                            $table.bootstrapTable('updateCell', {
                                index: $.getRowIndex(row),
                                field: field,
                                value: oldValue
                            });
                        },
                        complete: function () {

                        }

                    });
                }
            });

        });

        function queryParams(params) {
            params = $.extend($("#queryFrom").mineSerializeObject(), params);
            return params;
        }

        function queryClick() {
            $("#bootstrapTable").bootstrapTable('refreshOptions', {pageNumber: 1});
        }

        function showModal() {
            $('#modal').modal({show: true});
        }

        function showAlert(title, type) {
            $alert.attr('class', 'alert alert-' + type || 'success')
                .html('<i class="glyphicon glyphicon-check"></i> ' + title).show();
            $alert.show();
            setTimeout(function () {
                $alert.hide();
            }, 3000);
        }

        function editSave() {
            alert("sdfd");
        }

    </script>
</head>
<body>
<div layout:fragment="layout-content-title">用户管理</div>
<div layout:fragment="layout-content-body">

    <div class="panel panel-success layout-panel">
        <div class="panel-heading">查询条件</div>
        <div class="panel-body">
            <form id="queryFrom" class="form-inline">
                <fieldset>
                    <input type="text" class="form-control input-sm" name="userName" value="" placeholder="用户名"/>
                    <br/><br/>
                    <div class='input-group date'>
                        <input id='start' name="requestTimeStart" type='text' class="form-control input-sm"
                               placeholder="更新时间"/>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                    </div>
                    <div class='input-group date'>
                        <input id='end' name="requestTimeEnd" type='text' class="form-control input-sm"
                               placeholder="更新时间"/>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                    </div>
                    <input type="button" class="btn btn-primary btn-sm layout-btn-right" onclick="queryClick();"
                           value="查询"/>
                </fieldset>
            </form>
        </div>
    </div>
    <p id="toolbar">
        <button id="create" type="button" class="btn btn-primary btn-sm" onclick="showModal();">
            <span class="glyphicon glyphicon-plus"></span>&nbsp;新建
        </button>
        <button id="remove" type="button" class="btn btn-danger btn-sm" onclick="" disabled="disabled">
            <span class="glyphicon glyphicon-remove"></span>&nbsp;删除
        </button>

        <span class="alert"
              style="margin-left:100px;display: none"></span>

    </p>
    <table id="bootstrapTable" class="table table-striped table-condensed table-hover">
        <!--data-toggle="table"-->
        <!--data-method="post"-->
        <!--data-query-params="queryParams"-->
        <!--data-query-params-type=""-->
        <!--data-url="/users/list"-->
        <!--data-side-pagination="server"-->
        <!--data-toolbar="#toolbar"-->
        <!--data-pagination="true"-->
        <!--data-search="true"-->
        <!--data-show-refresh="true"-->
        <!--data-show-toggle="true"-->
        <!--data-show-columns="true"-->
        <!--data-sort-name="id"-->
        <!--data-sort-order="desc"-->
        <!--data-striped="true"-->
        <!--data-click-to-select="true"-->
        <!--data-trim-on-search="false">-->
        <!--<thead>-->
        <!--<tr>-->
        <!--<th data-width="50" data-checkbox="true">ID</th>-->
        <!--<th data-field="id" data-visible="true" data-sortable="true" data-width="80">ID</th>-->
        <!--<th data-field="userName" data-sortable="true" data-editable="true"-->
        <!--data-visible="true"-->
        <!--data-width="100">-->
        <!--用户名-->
        <!--</th>-->
        <!--<th data-field="createdOn" data-visible="true" data-switchable="true" data-sortable="true"-->
        <!--data-width="150">创建时间-->
        <!--</th>-->
        <!--<th data-field="updatedOn" data-visible="true" data-switchable="true" data-sortable="false"-->
        <!--data-width="150">更新时间-->
        <!--</th>-->
        <!--</tr>-->
        <!--</thead>-->
    </table>


    <div id="modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title"></h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>用户名</label>
                        <input type="text" class="form-control" name="userName" placeholder="用户名"/>
                    </div>
                    <div class="form-group">
                        <label>密码</label>
                        <input type="password" class="form-control" name="password" placeholder="密码"/>
                    </div>
                    <div class="form-group">
                        <label>确认密码</label>
                        <input type="password" class="form-control" placeholder="确认密码"/>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary submit">提交</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

</div>

</body>
</html>